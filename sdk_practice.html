<!DOCTYPE html>
<html>
    <h3>
        Backend.AI SDK Practice
    </h3>
    <body>
        <div>
            <h4>Login</h4>
            <form>
                ID: <br/>
                <input type='text' id='user_id' autocomplete='username' placeholder='Username'/><br/>
                PW: <br/>
                <input type='password' id='password' autocomplete='current-password' placeholder='Password'/><br/><br/>
                <!-- TODO: Implement onclick method to pass user ID and password -->
                <input type='button' id='login' value='Login' onclick='login()'/>
            </form>
        </div>
        <div>
            <h4>DL Code</h4>
            <textarea id='dl_code' style='height: 300px; width: 500px' placeholder='Write your DL code.'></textarea><br/>
            <button id='dl_run'>Run</button>
            <h4>DL Result</h4>
            <div id='dl_result'>DL Runtime Result Contents</div>
        </div>
        <script type='module'>
            // Can be changed according to your directory path.
            import './backend.ai-client-js/backend.ai-client-es6.js';

            // Create a client configuration object with ACCESS_KEY, SECRET_KEY and api_endpoint .
            let config = new ai.backend.ClientConfig(
                'AKIAIOSFODNN7EXAMPLE',
                'wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY',
                'http://127.0.0.1:9003',
                'SESSION',
            );

            // Create a client object with configuration object.
            let client = new ai.backend.Client(
                config,
                `Backend.AI ES6 App.`,
            );

            client.getManagerVersion()

            async function login() {
                // Set user ID and password.
                // config._userId = document.getElementById('user_id').value;
                // config._password = document.getElementById('password').value;
                config._userId = 'admin@lablup.com';
                config._password = 'wJalrXUt';

                let isLogon = await client.check_login();
                if (isLogon === false) {
                    client.login().then(response => {
                        if (response === false) {
                            if (config._userId != '' && config._password != '') {
                                console.log(`Login information mistmatch. Please check your login information,`);
                            } else if (response.fail_reason) {
                                if (config._userId != '' && config._password != '') {
                                    console.log(`Login falied: ${response.fail_reason}.`);
                                }
                            } else {
                                console.log(`Login succeeded.`);
                            }
                        }
                    }).catch(err => {
                        console.log(`Login failed: ${err.message}`);
                    });
                } else {
                    console.log(`Login already succeeded.`);
                }
            }

            let mysessionId = '';
            let code = "print('hello world')";
            let tmp;
            let result;
            login().then(async response => {
                let version = await client.getManagerVersion();
                return client.createIfNotExists('index.docker.io/lablup/python:3.8-ubuntu18.04', 'test', {'cpu': 1, 'mem': '1g'});
            }).then(response => {
                mysessionId = response.sessionId;
                console.log(`My session is created: ${response.sessionId}`);
                return client.execute(mysessionId, 1, 'query', code, {});
            }).then(response => {
                console.log(response);
            }).catch(err => {
                switch (err.type) {
                    case ai.backend.Client.ERR_SERVER:
                        console.log(`Session creation failed: ${err.message}`);
                        break;
                    default:
                        console.log(`request/response failed: ${err.message}`);
                }
            });


        </script>
    </body>
</html>